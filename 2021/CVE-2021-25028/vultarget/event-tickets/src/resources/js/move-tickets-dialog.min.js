var tribe_move_tickets=tribe_move_tickets||{};!function(t,e){var i,a,o,c,s,n,r,_,d,p,v,l;function m(t){s=(c=t).attr("id"),n.hide(),c.show(),i.trigger("pre-activate-stage.tribe"),i.trigger("activate-"+s+".tribe")}function k(t){(t=parseInt(t,10))>0&&v!==t&&(v=t,i.trigger("destination-post-selected.tribe"))}function f(t,e){e===s&&(t.removeProp("disabled").show().removeClass("disabled"),"next"===t.attr("id")&&h()&&t.addClass("button-primary"))}function u(t,e){e===s&&t.prop("disabled",!0).addClass("disabled").removeClass("button-primary")}function b(t,e){e===s&&t.hide()}function h(){return!c.next(".stage").length}e.get_main_element=function(){return i},e.hide_btn=b,e.disable_btn=u,e.enable_btn=f,e.activate_stage=m,t(function(){i=t("#main"),o=t(".error"),a=t("#processing"),r=t("#back"),_=t("#next"),i.trigger("move-tickets-dialog-pre-init.tribe"),r.add(_).hide(),a.hide(),o.length||(_.show(),function(){var e,a=t("#choose-event").find(".select-single-container"),o=t("#post-type"),s=t("#search-terms"),r="choose-event",v=!1;function l(){if(!v){v=!0,a.css("opacity",.6),u(_,r);var e={action:"move_tickets_get_post_choices",check:tribe_move_tickets_data.check,post_type:o.val(),search_terms:s.val(),ignore:tribe_move_tickets_data.src_post_id};t.post(ajaxurl,e,function(t){if(void 0!==t.data&&"object"==typeof t.data.posts){a.html("");var e=0;for(var i in t.data.posts){var o=parseInt(i,10),c=t.data.posts[i];e++,a.append('<label> <input type="radio" value="'+o+'" name="post-choice">'+c+"</label>")}e||a.append("<label>"+tribe_move_tickets_data.no_posts_found+"</label>"),v=!1,a.css("opacity",1)}})}}function b(){var t=a.find("input:checked");a.find(".selected").removeClass("selected"),t.length&&(k(t.val()),t.parent("label").addClass("selected"),f(_,r))}i.on("activate-choose-event.tribe",function(){u(_,r),p&&"next"===d?m(c.next()):p&&m(n.first()),b()}),function(){o.html('<option value="">'+tribe_move_tickets_data.loading_msg+"</option>");var e={action:"move_tickets_get_post_types",check:tribe_move_tickets_data.check};t.post(ajaxurl,e,function(t){if(void 0!==t.data&&"object"==typeof t.data.posts)for(var e in o.html(""),t.data.posts)o.append('<option value="'+e+'">'+t.data.posts[e]+"</option>")})}(),l(),s.keyup(function(){clearTimeout(e),e=setTimeout(l,200)}),o.change(l),a.click(function(){v||b()})}(),"move_tickets"===tribe_move_tickets_data.mode?(function(){var e="move-where",a=t('input[name="move-where"]');function o(){var t=a.filter(":checked");t.length?("this-post"===t.val()?(k(tribe_move_tickets_data.src_post_id),p=!0):(v=!1,p=!1),f(_,e)):u(_,e)}i.on("activate-move-where.tribe",function(){b(r,e),o()}),a.change(o)}(),e="choose-ticket-type",s=t("#choose-ticket-type").find(".select-single-container"),i.on("activate-choose-ticket-type.tribe",function(){u(_,e),v||m(n.first())}),i.on("destination-post-selected.tribe",function(){s.css("opacity",.6),u(_,e);var i={action:"move_tickets_get_ticket_types",check:tribe_move_tickets_data.check,post_id:v,provider:tribe_move_tickets_data.provider,ticket_ids:tribe_move_tickets_data.ticket_ids};t.post(ajaxurl,i,function(t){if("object"==typeof t.data.posts){s.html("");var e=0;for(var i in t.data.posts){var a=parseInt(i,10),o=t.data.posts[i];e++,s.append('<label> <input type="radio" value="'+a+'" name="post-choice">'+o+"</label>")}e||s.append("<label>"+tribe_move_tickets_data.no_ticket_types_found+"</label>"),s.css("opacity",1)}})}),s.click(function(){var t=s.find("input:checked");s.find(".selected").removeClass("selected"),t.length&&(l=parseInt(t.val()),t.parent("label").addClass("selected"),f(_,e))})):(t("#move-where").remove(),t("#choose-ticket-type").remove()),n=t(".stage"),function(){var e=_.html(),a=_.data("final-text");function o(t){d=t;var e=c[t](".stage");e.length?m(e):h()&&i.trigger("move-tickets-final-stage.tribe")}a=a||e,i.on("pre-activate-stage.tribe",function(){_.html(h()?a:e)}),r.add(_).click(function(){switch(t(this).attr("id")){case"back":o("prev");break;case"next":o("next")}})}(),function(){function e(e){if(void 0!==e.data&&"string"==typeof e.data.message){if(a.html(e.data.message),"string"==typeof e.data.redirect_top){var i="number"==typeof e.data.redirect_top_delay?e.data.redirect_top_delay:2e3;setTimeout(function(){top.location=e.data.redirect_top},i)}"number"==typeof e.data.remove_ticket_type&&top.jQuery("table.ticket_list").find('tr[data-ticket-type-id="'+e.data.remove_ticket_type+'"]').remove(),top.jQuery("#ticket_form_cancel").trigger("click"),t.isArray(e.data.remove_tickets)&&top.tribe_event_tickets_attendees.remove_tickets(e.data.remove_tickets)}else o()}function o(){a.html(tribe_move_tickets_data.unexpected_failure)}i.on("move-tickets-final-stage.tribe",function(){switch(tribe_move_tickets_data.mode){case"move_tickets":!function(){if(v&&l){var i={action:"move_tickets",src_post_id:tribe_move_tickets_data.src_post_id,target_post_id:v,check:tribe_move_tickets_data.check,ticket_ids:tribe_move_tickets_data.ticket_ids,target_type_id:l};n.hide(),r.hide(),_.hide(),a.show(),t.post(ajaxurl,i,function(t){e(t)}).fail(o)}}();break;case"ticket_type_only":!function(){if(v){var i={action:"move_ticket_type",src_post_id:tribe_move_tickets_data.src_post_id,ticket_type_id:tribe_move_tickets_data.ticket_type_id,target_post_id:v,check:tribe_move_tickets_data.check};n.hide(),r.hide(),_.hide(),a.show(),t.post(ajaxurl,i,function(t){e(t)}).fail(o)}}()}})}(),m(n.first())),i.trigger("move-tickets-dialog-post-init.tribe");var e,s})}(jQuery,tribe_move_tickets);