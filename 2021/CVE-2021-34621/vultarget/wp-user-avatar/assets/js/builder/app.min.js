!function(e,t,i,l){"use strict";function a(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var d=a(e),n=a(t),o=a(i),r=a(l),p=n.default.View.extend({className:"pp-form-buider-settings-popup-container",iconPickerTemplate:o.default.template("pp-form-builder-material-icon"),events:{"click .pp-form-cancel-btn":"cancel_settings","click .pp-form-buider-settings-popup-tab-menu":"switch_tab","click .pp-form-save-btn":"save_changes","click .pp-form-control-icon-picker":"icon_picker","keyup input[name=label].pp-form-control":"make_label_placeholder"},initialize:function(e){if(void 0===e.fieldType)throw new Error("Field Type required");this.options=e,_.bindAll(this,"switch_tab"),_.bindAll(this,"save_changes"),_.bindAll(this,"icon_picker")},icon_picker:function(e){e.preventDefault();var t=this,i=d.default(e.target);(t.jboxInstance=new jBox("Modal",{title:d.default("#pp-form-material-icon-picker-tmpl-title").html(),maxWidth:600,zIndex:999999999,addClass:"pp-icon-picker-jbox-wrap",overlayClass:"pp-icon-picker-jbox-overlay",animation:"zoomIn",content:d.default("#pp-form-material-icon-picker-tmpl"),onOpen:function(){var e=d.default("input.pp-form-control",i.parent()),l=e.val(),a=d.default("#pp-form-material-icon-picker-tmpl");a.find(".pp-form-material-icon-wrap").removeClass("pp-active"),""!==l&&a.find('.pp-form-material-icon-wrap[data-material-icon="'+l+'"]').addClass("pp-active"),d.default(".pp-form-material-icon-wrap").click((function(){var l=d.default(this).data("material-icon");i.html(t.iconPickerTemplate({icon:l})),e.val(l),t.jboxInstance.close()}))}})).open()},save_changes:function(e){e.preventDefault();var t=this;d.default(".pp-form-control").each((function(){var e=d.default(this).attr("name"),i=d.default(this).val();"checkbox"===d.default(this).attr("type")&&(i=this.checked),void 0!==e&&t.options.model.set(e,i)})),d.default("#label",this.$el).length>0?t.options.model.set("fieldBarTitle",d.default("#label",this.$el).val()):t.options.model.set("fieldBarTitle",d.default("#placeholder",this.$el).val()),t.remove()},switch_tab:function(e){e.preventDefault(),d.default(".pp-form-buider-settings-popup-tab-menu",this.$el).removeClass("active"),d.default(e.target).addClass("active"),d.default(".pp-form-buider-settings-popup-tab-content",this.$el).hide(),d.default(d.default(e.target).attr("href")).show()},make_label_placeholder:function(e){e.preventDefault();var t=d.default("input[name=placeholder]",this.$el);!0!==this.$el.data("make_label_placeholder_flag")&&this.$el.data("make_label_placeholder_flag",""===t.val()),!0===this.$el.data("make_label_placeholder_flag")&&t.val(d.default(e.target).val())},cancel_settings_outside:function(e){e.target==this.el&&this.remove()},cancel_settings:function(e){e.preventDefault(),this.remove()},render:function(){var e=-1!==this.options.fieldType.indexOf("reg-cpf")?"reg-cpf":this.options.fieldType;e=-1!==e.indexOf("edit-profile-cpf")?"edit-profile-cpf":e;var t=this.options.model.get("definedFieldType");void 0!==t&&(e=e+"-"+t);var i=o.default.template("pp-form-builder-popup-settings-"+e);this.$el.html(i(this.options.model.toJSON())),d.default(".pp-form-buider-settings-popup-tab-menu",this.$el).eq(0).addClass("active"),d.default(".pp-form-buider-settings-popup-tab-content",this.$el).hide().eq(0).show()}}),s=n.default.View.extend({className:"pp-builder-element",template:o.default.template("pp-form-builder-field-bar"),events:{"click .pp-builder-element-expand-button.pp-settings":"reveal_settings","click .pp-builder-element-expand-button.pp-delete":"delete_field","click .pp-builder-element-expand-button.pp-clone":"clone_field"},reveal_settings:function(e){e.preventDefault(),d.default(e.target).parent("a").blur();var t=this.model.get("fieldType"),i=new p({fieldType:t,model:this.model});i.render(),d.default("body").append(i.$el);var l=d.default(".pp-form-control-wpeditor");l.length>0&&l.each((function(){var e=d.default(this).attr("id");d.default("#"+e).pp_wp_editor({mode:"tmce"}),tinymce.get(e).on("keyup change undo redo SetContent",(function(){this.save()}))}))},delete_field:function(e){e.preventDefault(),confirm(pp_form_builder.confirm_delete)&&(d.default(e.target).parent("a").blur(),this.remove(),this.collection.remove(this.model))},clone_field:function(e){e.preventDefault(),d.default(e.target).parent("a").blur(),this.collection.add(this.model.clone(),{at:this.collection.indexOf(this.model)})},render:function(){var e=this.model.get("fieldType"),t=void 0!==pp_form_builder_combined_fields[e]&&"undefined"!==pp_form_builder_combined_fields[e].fieldTitle?pp_form_builder_combined_fields[e].fieldTitle:this.model.get("fieldTitle");this.$el.html(this.template({fieldType:e,fieldTitle:t,fieldIcon:this.model.get("fieldIcon"),fieldBarTitle:this.model.get("fieldBarTitle")})).data("modelCID",this.model.cid)}}),f=function(e,t,i,l){var a=i.findWhere({fieldType:"footer"}),d="pp_form_builder_"+t+"_fields";l=void 0!==l?l:i.indexOf(a);var n=_.extend(window[d][e],{fieldType:e});i.add(n,{at:l,sort:!1})},c=function(e){d.default("#pp-form-builder-fields-settings").val(JSON.stringify(e.toJSON())),d.default(".pp_edit_form form").submit()},u=n.default.View.extend({el:"#pp-form-builder",initialize:function(){_.bindAll(this,"update_sort_index"),_.bindAll(this,"addFieldOnDrop"),this.listenTo(this.collection,"add",this.render),this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"pp_fieldBarTitle_changed",this.render)},initSortable:function(){this.$el.sortable({items:".pp-builder-element",cursor:"move",placeholder:"pp-form-builder-drag-bg",update:this.update_sort_index,receive:this.addFieldOnDrop})},addFieldOnDrop:function(e,t){var i,l;0===t.helper.prev().length||void 0===t.helper.prev().data("modelCID")?i=0:(l=t.helper.prev().data("modelCID"),i=this.collection.get(l).get("sortID"));var a=t.helper.find("a").data("field-type"),d=t.helper.find("a").data("field-category");f(a,d,this.collection,i),this.update_sort_index(),t.helper.remove()},update_sort_index:function(){var e=this.collection;d.default(".pp-builder-form-content .pp-builder-element").each((function(t){t++;var i=d.default(this).data("modelCID");e.get(i).set("sortID",t)})),e.sort()},render:function(){var e=this.collection,t=[];e.each((function(i){var l=new s({model:i,collection:e});l.render(),t.push(l.el)})),this.$el.find(".pp-form-builder-body .pp-builder-form-content").html(t),this.initSortable()}}),m=n.default.View.extend({el:"#pp-form-builder-metabox",events:{"click .pp_upload_button":"media_upload"},initialize:function(){d.default(".pp-color-field",this.$el).wpColorPicker(),d.default(".ppselect2",this.$el).select2(),this.tabify(),new jBox("Tooltip",{attach:".pp-form-builder-help-tip",maxWidth:200,theme:"TooltipDark"}),d.default(".form-field .wp-picker-container",this.$el).parent(".pp-field-row-content").css("width","auto")},tabify:function(){d.default("ul.pp-tabs li a",this.$el).click((function(e){e.preventDefault(),d.default(".pp-form-builder_options_panel").hide(),d.default("#pp-form-builder-metabox ul.pp-tabs li").removeClass("active"),d.default(this).parent().addClass("active"),d.default(d.default(this).attr("href")).show()})).get(0).click()},media_upload:function(e){e.preventDefault();var t,i=d.default(e.target);t||(t=wp.media.frames.file_frame=wp.media({frame:"select",multiple:!1,library:{type:"image"}})).on("select",(function(){var e=t.state().get("selection").first().toJSON();i.parents(".pp_upload_field_container").find(".pp_upload_field").val(e.url)})),t.open()}}),h=n.default.View.extend({el:".pp-form-builder-sidebar-wrap",template:o.default.template("pp-form-builder-sidebar-fields-block"),events:{"click .pp-draggable-field":"add_field","click .pp-form-save-changes":"save_changes"},initialize:function(){this.listenTo(this.collection,"add",this.disable_active_standard_fields),this.listenTo(this.collection,"remove",this.enable_inactive_standard_fields)},initDraggable:function(){this.$el.find(".pp-draggable-field").draggable({connectToSortable:"#pp-form-builder",helper:"clone",revert:"invalid",delay:10})},add_field:function(e){if(e.preventDefault(),d.default(e.target).parent(".pp-draggable-field").hasClass("ui-draggable-disabled"))return!1;var t=d.default(e.target).data("field-type"),i=d.default(e.target).data("field-category");f(t,i,this.collection)},save_changes:function(e){e.preventDefault(),c(this.collection)},disable_active_standard_fields:function(){this.collection.each((function(e){var t=e.get("fieldType");r.default.contains(pp_form_builder_fields_multiple_addition,t)||(d.default('[data-field-type="'+t+'"]',"#pp-form-builder-standard-fields").attr("disabled","disabled").parent(".pp-draggable-field").draggable("disable"),d.default('[data-field-type="'+t+'"]',"#pp-form-builder-defined-fields").attr("disabled","disabled").parent(".pp-draggable-field").draggable("disable"))}))},enable_inactive_standard_fields:function(e){var t=e.get("fieldType");r.default.contains(pp_form_builder_fields_multiple_addition,t)||(d.default('[data-field-type="'+t+'"]',"#pp-form-builder-standard-fields").removeAttr("disabled","disabled").parent(".pp-draggable-field").draggable("enable"),d.default('[data-field-type="'+t+'"]',"#pp-form-builder-defined-fields").removeAttr("disabled","disabled").parent(".pp-draggable-field").draggable("enable"))},render:function(){var e=[this.template({fieldsBlockType:"standard",fields:pp_form_builder_standard_fields})];!1===r.default.isEmpty(pp_form_builder_defined_fields)&&e.push(this.template({fieldsBlockType:"defined",fields:pp_form_builder_defined_fields})),!1===r.default.isEmpty(pp_form_builder_wc_billing_fields)&&e.push(this.template({fieldsBlockType:"wc_billing",fields:pp_form_builder_wc_billing_fields})),!1===r.default.isEmpty(pp_form_builder_wc_shipping_fields)&&e.push(this.template({fieldsBlockType:"wc_shipping",fields:pp_form_builder_wc_shipping_fields})),this.$el.find("#pp-form-builder-sidebar-fields-block").html(e),this.initDraggable(),this.disable_active_standard_fields()}}),b=n.default.Model.extend({initialize:function(){this.on("change:fieldBarTitle",(function(e,t){this.trigger("pp_fieldBarTitle_changed")}))}}),v=n.default.Collection.extend({model:b}),g=function(){d.default("#title").each((function(){var e=d.default(this),t=d.default("#"+this.id+"-prompt-text");""===this.value&&t.removeClass("screen-reader-text"),t.click((function(){d.default(this).addClass("screen-reader-text"),e.focus()})),e.blur((function(){""===this.value&&t.removeClass("screen-reader-text")})),e.focus((function(){t.addClass("screen-reader-text")}))}))},w=function(){d.default(document).on("click",".pp-metabox-handle",(function(e){e.preventDefault();var t=d.default(this),i=d.default(".pp-metabox-handle"),l=d.default(this).parents(".pp-postbox-wrap");i.parents(".pp-postbox-wrap").find(".postbox-header").removeClass("postbox").removeClass("closed"),i.not(t).parents(".pp-postbox-wrap").addClass("closed"),l.hasClass("closed")?l.removeClass("closed"):l.addClass("closed")})),d.default("#pp-form-builder-standard-fields .pp-metabox-handle").click()},k=function(){var e=new v(pp_form_builder_fields_settings);window.ppFormSettings=e,e.comparator="sortID",new u({collection:e}).render(),new h({collection:e}).render(),d.default(document).on("click",".pp-form-save-changes",(function(e){e.preventDefault(),c(window.ppFormSettings)})),new m};d.default((function(){var e=d.default(".pp-dnd-form-builder-wrap");0!==e.length&&(k(),g(),w(),setTimeout((function(){e.css("opacity","1")}),500))}))}(jQuery,Backbone,wp,_);